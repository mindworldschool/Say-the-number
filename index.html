<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Say the Number - MindWorld School</title>

    <!-- Иконка -->
    <link rel="icon" type="image/png" href="./assets/logo.png" />

    <!-- Шрифты -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600&family=Montserrat:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <!-- Стили -->
    <link rel="stylesheet" href="./styles.css" />
  </head>

  <body>
    <header class="app-header">
      <div class="app-header__brand">
        <img
          src="./assets/logo.png"
          alt="MindWorld School logo"
          class="app-header__logo"
        />

        <div class="app-header__titles">
          <h1 class="app-header__title">
            <span class="title-main" id="appTitle">Say the Number</span>
          </h1>
          <h2 id="appTagline" class="app-header__tagline">
            Розпізнавання чисел на абакусі
          </h2>
        </div>
      </div>

      <!-- Переключатель языков -->
      <div id="languageSwitcher" class="app-header__languages"></div>
    </header>

    <main id="app" class="app-main" role="main"></main>

    <footer id="appFooter" class="app-footer">MindWorld School © 2025</footer>

    <!-- Детектор языка -->
    <script>
      (function () {
        const SUPPORTED_LANGS = ["ua", "en", "ru", "es"];
        const params = new URLSearchParams(window.location.search);
        let lang = params.get("lang");

        // 1. Проверяем параметр lang в URL
        if (!SUPPORTED_LANGS.includes(lang)) {
          // 2. Если нет — пробуем определить по referrer (откуда пришел пользователь)
          const referrer = document.referrer;
          console.log("[Say the Number] Referrer:", referrer);

          if (referrer) {
            // Проверяем языковые версии сайта по пути
            if (referrer.includes("/en/") || referrer.endsWith("/en")) {
              lang = "en";
            } else if (referrer.includes("/ru/") || referrer.endsWith("/ru")) {
              lang = "ru";
            } else if (referrer.includes("/es/") || referrer.endsWith("/es")) {
              lang = "es";
            } else if (referrer.includes("mindworldschool.com") || referrer.includes("mindworldschool.github.io")) {
              // Украинская версия на основном домене без языкового префикса
              lang = "ua";
            }
          }

          // 3. Если не определили — пробуем взять из localStorage
          if (!SUPPORTED_LANGS.includes(lang)) {
            const saved = localStorage.getItem("mws_lang");
            if (SUPPORTED_LANGS.includes(saved)) {
              lang = saved;
            } else {
              // 4. Язык браузера
              const browserLang = (navigator.language || "").toLowerCase();
              if (browserLang.startsWith("uk") || browserLang.startsWith("ua")) {
                lang = "ua";
              } else if (browserLang.startsWith("en")) {
                lang = "en";
              } else if (browserLang.startsWith("ru")) {
                lang = "ru";
              } else if (browserLang.startsWith("es")) {
                lang = "es";
              } else {
                // 5. Язык по умолчанию
                lang = "ua";
              }
            }
          }
        }

        console.log("[Say the Number] Selected language:", lang);

        // 6. Сохраняем язык
        localStorage.setItem("mws_lang", lang);

        // 7. Передаём язык в main.js
        window.APP_LANG = lang;

        // 8. Обновляем lang в <html>
        const langMap = { ua: "uk", en: "en", ru: "ru", es: "es" };
        document.documentElement.lang = langMap[lang] || "uk";
      })();
    </script>

    <!-- Основной JS -->
    <script type="module" src="./main.js"></script>
  </body>
</html>
